# MediBridge - 医疗数据采集系统

自动化采集好大夫在线医生信息的智能系统。

## 项目概览

**目标**：自动抓取6个顶级医院123个科室的医生详细信息

**医院列表**：
- 复旦大学附属中山医院（25个科室）
- 瑞金医院（29个科室）
- 华山医院（22个科室）
- 上海市第九人民医院（22个科室）
- 上海市第六人民医院（16个科室）
- 复旦大学附属肿瘤医院（9个科室）

**数据字段**（14个）：
1. 医院
2. 科室
3. 姓名
4. 职称
5. 专业方向
6. 专业擅长
7. 个人简介
8. 社会任职
9. 科研成果
10. 治疗经验
11. 疗效满意度
12. 态度满意度
13. 病友推荐度
14. 医生介绍页URL

## 目录结构

```
medibridge/
├── data/
│   ├── departments/
│   │   ├── all_departments.json      # 所有123个科室的列表
│   │   └── progress.json              # 抓取进度日志
│   └── hospitals/
│       ├── {医院}.xlsx                # 科室列表（用户上传）
│       └── {医院}_{科室}_医生信息_{日期}.xlsx  # 抓取结果
├── scripts/
│   ├── daily_scrape.md               # 每日抓取任务流程文档
│   └── track_progress.py             # 进度跟踪脚本
└── README.md                         # 本文件
```

## 核心功能

### 1. 进度跟踪系统

自动检查已抓取和未抓取的科室：

```bash
python3 scripts/track_progress.py
```

输出示例：
```
总科室数: 123
已完成: 1
剩余: 122
进度: 0.81%

按医院统计:
  中山医院: 1/25
  瑞金医院: 0/29
  ...

下一个待抓取科室:
  医院: 上海市第九人民医院
  科室: 口腔科
  URL: https://www.haodf.com/hospital/422/keshi/9597922647.html
```

### 2. 自动化抓取

**执行方式**：每日定时任务（凌晨2点）

**抓取策略**：
- 一次只抓取一个科室
- 科室内医生按10个为一组并行抓取
- 跳过无个人简介的医生
- 遇到验证码立即停止并保存数据

**数据质量**：
- 基本字段：100%完整
- 专业字段：95%完整
- 学术字段：85%完整
- 治疗经验：30-50%完整
- 评分字段：100%完整

### 3. 验证码处理

遇到验证码时系统会：
1. 立即停止抓取
2. 保存已抓取的数据到Excel
3. 推送到GitHub
4. 通知用户

## 使用技能

系统使用 `haodf-doctor-scraper` 技能进行数据抓取。

技能位置：`/home/ubuntu/skills/haodf-doctor-scraper/SKILL.md`

**关键特性**：
- 14个标准化字段
- 自动处理缺失数据
- 增量保存进度
- 质量验证报告

## 数据输出

每个科室生成一个Excel文件：

**文件名**：`{医院}_{科室}_医生信息_{日期}.xlsx`

**示例**：`中山医院_呼吸科_医生信息_20260211.xlsx`

**格式**：
- 每行一位医生
- 14列对应14个字段
- 包含完整的可追溯URL

## 执行流程

1. **检查进度** → 获取下一个待抓取科室
2. **访问科室页面** → 滚动到底部加载所有医生
3. **提取医生列表** → 保存到临时文件
4. **分组并行抓取** → 每10个医生一组
5. **生成Excel** → 使用技能提供的脚本
6. **推送GitHub** → 立即保存数据
7. **更新进度** → 记录完成状态
8. **继续或停止** → 根据是否遇到验证码

## 当前进度

- **总科室**：123个
- **已完成**：1个（中山医院呼吸科）
- **剩余**：122个
- **进度**：0.81%

## 下次执行

**时间**：每天凌晨2点（北京时间）

**预计完成**：6-10天（取决于验证码出现频率）

## 技术细节

**浏览器自动化**：使用用户的浏览器会话，避免登录问题

**反爬虫策略**：
- 温和的抓取速度（每个科室3-5分钟）
- 使用真实浏览器而非脚本
- 遇到验证码立即停止

**数据可靠性**：
- 每个医生包含原始URL
- 增量保存防止数据丢失
- 质量验证报告

## 维护说明

### 手动触发抓取

如果需要立即执行一次抓取（不等到凌晨2点）：

对Manus说：
> "执行好大夫医生信息抓取任务"

### 查看进度

```bash
cd /home/ubuntu/medibridge
python3 scripts/track_progress.py
```

### 查看数据

所有抓取的Excel文件在：
```
data/hospitals/{医院}_{科室}_医生信息_{日期}.xlsx
```

### 更新科室列表

如果需要添加新的医院或科室：
1. 在 `data/hospitals/` 目录上传新的科室列表Excel
2. 运行进度跟踪脚本更新 `all_departments.json`

## 联系方式

项目维护者：weiyufan1994
GitHub：https://github.com/weiyufan1994/medibridge

## 许可证

本项目仅用于医疗数据研究，请遵守好大夫在线的使用条款。
